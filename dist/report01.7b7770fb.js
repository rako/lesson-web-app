function e(e,t,s,a){Object.defineProperty(e,t,{get:s,set:a,enumerable:!0,configurable:!0})}var t=globalThis,s={},a={},r=t.parcelRequire49ed;null==r&&((r=function(e){if(e in s)return s[e].exports;if(e in a){var t=a[e];delete a[e];var r={id:e,exports:{}};return s[e]=r,t.call(r.exports,r,r.exports),r.exports}var n=Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}).register=function(e,t){a[e]=t},t.parcelRequire49ed=r),(0,r.register)("brsYM",function(t,s){e(t.exports,"LoginContext",()=>o),e(t.exports,"Authenticate",()=>l);var a=r("c54Ow"),n=r("lbJE2");let o=(0,n.createContext)(),l=e=>{let t=e.usernameSaveKey?`${document.location.pathname}#Authenticate${e.usernameSaveKey}`:void 0,s=t?localStorage.getItem(t):null,[r,l]=(0,n.useState)(void 0!==e.username?e.username:s),i=(0,n.useRef)(""),[d,c]=(0,n.useState)(""),[u,h]=(0,n.useState)(null),p=async()=>{try{c("");let e=await fetch("/login",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:r,password:i.current.value})});if(!e.ok){if(403===e.status)throw Error("ログイン・エラー");throw Error(`${e.status} ${e.statusText}`)}let s=await e.json();h(s),void 0!==t&&localStorage.setItem(t,r)}catch(e){c(e.message),h(null),void 0!==t&&localStorage.removeItem(t)}};return(0,n.useEffect)(()=>{if(void 0!==e.username&&void 0!==e.password)i.current.value=e.password,p();else if(void 0!==t){let e=localStorage.getItem(t);null!==e&&(i.current.value=e,l(e))}},[]),u?(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"authenticate-logout",children:[(0,a.jsxs)("span",{children:["User: ",u?u.username:""]}),void 0!==e.username&&void 0!==e.password?null:(0,a.jsx)("button",{type:"button",onClick:()=>{h(null),void 0!==t&&localStorage.removeItem(t)},children:"ログアウト"})]}),(0,a.jsx)(o.Provider,{value:u,children:e.children})]}):(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"authenticate-login",children:[(0,a.jsxs)("label",{children:[(0,a.jsx)("span",{children:"ユーザ名:"}),(0,a.jsx)("span",{children:(0,a.jsx)("input",{type:"text",placeholder:"ユーザ名",onChange:e=>l(e.target.value),value:r})})]}),(0,a.jsxs)("label",{children:[(0,a.jsx)("span",{children:"パスワード:"}),(0,a.jsx)("span",{children:(0,a.jsx)("input",{type:"password",ref:i,placeholder:"パスワード",defaultValue:""})})]}),(0,a.jsx)("button",{type:"button",onClick:p,children:"ログイン"})]}),(0,a.jsx)("div",{children:""===d?null:(0,a.jsx)("div",{className:"error-message",onClick:()=>c(""),children:d})})]})}});var n=r("c54Ow"),o=r("dFw4U"),l=r("aFIWk"),n=r("c54Ow"),i=r("lbJE2"),d=r("brsYM");const c=new Date,u=c.getFullYear(),h=c.getMonth()+1,p=c.getDate(),m=`${u.toString()}-${h.toString().padStart(2,"0")}-
${p.toString().padStart(2,"0")}`;var d=r("brsYM");(0,o.createRoot)(document.getElementById("root")).render((0,n.jsxs)(l.ErrorBoundary,{children:[(0,n.jsx)("p",{children:"ログイン機能を使用した場合"}),(0,n.jsx)(d.Authenticate,{usernameSaveKey:"key1",children:(0,n.jsx)(e=>{let[t,s]=(0,i.useState)([]),[a,r]=(0,i.useState)(""),o=(0,i.useContext)(d.LoginContext),l=o?{Authorization:"Bearer "+o.token}:{},c=e=>!e.completed&&e.deadline&&e.deadline<m,u=async()=>{try{r("");let t=await fetch(e.url,{method:"GET",headers:l});if(!t.ok)throw Error(`${t.status} ${t.statusText}`);let a=await t.json();s(a)}catch(e){r(e.message)}},[h,p]=(0,i.useState)(""),x=async()=>{let t=j.current.value;try{r("");let s=await fetch(e.url,{method:"POST",headers:{"Content-Type":"application/json",...l},body:JSON.stringify({description:h,completed:!1,...o?{username:o.username}:{},...t?{deadline:t}:{}})});if(!s.ok)throw Error(`${s.status} ${s.statusText}`);p(""),j.current.value="",u()}catch(e){r(e.message)}},v=async t=>{try{r("");let s=await fetch(e.url+"/"+t._id,{method:"DELETE",headers:l});if(!s.ok)throw Error(`${s.status} ${s.statusText}`);u()}catch(e){r(e.message)}},g=async(t,s)=>{let a={...t,...s};try{r("");let s=await fetch(e.url+"/"+t._id,{method:"PUT",headers:{"Content-Type":"application/json",...l},body:JSON.stringify(a)});if(!s.ok)throw Error(`${s.status} ${s.statusText}`);u()}catch(e){r(e.message)}};(0,i.useEffect)(()=>{u()},[]);let j=(0,i.useRef)(null),[y,f]=(0,i.useState)(!0),S=t.filter(e=>y||!e.completed),[b,k]=(0,i.useState)(!1);return(0,n.jsxs)("div",{className:"todo-list",children:[(0,n.jsxs)("div",{className:"todo-list-head",children:[(0,n.jsxs)("span",{onClick:u,children:["ToDoリスト [",e.url,"] "]}),(0,n.jsxs)("label",{children:[(0,n.jsx)("input",{type:"checkbox",checked:y,onChange:e=>{f(e.target.checked)}}),"完了済のタスクも表示"]})]}),0===S.length?null:(0,n.jsx)("div",{className:"todo-list-task-list",children:S.map(e=>(0,n.jsxs)("div",{className:"todo-list-task"+(e.completed?" todo-list-completed":"")+(c(e)?" todo-list-overdue":""),children:[(0,n.jsx)("input",{type:"checkbox",checked:e.completed,onChange:t=>g(e,{completed:t.target.checked})}),(0,n.jsx)("span",{className:"todo-list-description",children:e.description}),(0,n.jsx)("input",{className:"todo-list-deadline",type:"date",value:e.deadline,onChange:t=>g(e,{deadline:t.target.value})}),(0,n.jsxs)("span",{className:"todo-list-username",children:["【",e.username,"】"]}),(0,n.jsx)("button",{type:"button",onClick:()=>v(e),children:"削除"})]},e._id))}),(0,n.jsxs)("div",{className:"todo-list-task-input",children:[(0,n.jsx)("input",{type:"text",onChange:e=>{p(e.target.value)},placeholder:"タスク",value:h,onKeyDown:function(e){"Enter"!==e.key||b||handleSubmit()},onCompositionStart:()=>k(!0),onCompositionEnd:()=>k(!1)}),(0,n.jsx)("input",{type:"date",ref:j,defaultValue:""}),(0,n.jsx)("button",{type:"button",onClick:x,children:"追加"})]}),""===a?null:(0,n.jsx)("div",{className:"error-message",onClick:()=>r(""),children:a})]})},{url:"/todo-secure"})})]}));
//# sourceMappingURL=report01.7b7770fb.js.map
