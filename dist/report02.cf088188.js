function e(e,t,s,r){Object.defineProperty(e,t,{get:s,set:r,enumerable:!0,configurable:!0})}var t=globalThis,s={},r={},n=t.parcelRequire49ed;null==n&&((n=function(e){if(e in s)return s[e].exports;if(e in r){var t=r[e];delete r[e];var n={id:e,exports:{}};return s[e]=n,t.call(n.exports,n,n.exports),n.exports}var o=Error("Cannot find module '"+e+"'");throw o.code="MODULE_NOT_FOUND",o}).register=function(e,t){r[e]=t},t.parcelRequire49ed=n);var o=n.register;o("brsYM",function(t,s){e(t.exports,"LoginContext",()=>l),e(t.exports,"Authenticate",()=>a);var r=n("c54Ow"),o=n("lbJE2");let l=(0,o.createContext)(),a=e=>{let t=e.usernameSaveKey?`${document.location.pathname}#Authenticate${e.usernameSaveKey}`:void 0,s=t?localStorage.getItem(t):null,[n,a]=(0,o.useState)(void 0!==e.username?e.username:s),i=(0,o.useRef)(""),[c,u]=(0,o.useState)(""),[d,x]=(0,o.useState)(null),h=async()=>{try{u("");let e=await fetch("/login",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:n,password:i.current.value})});if(!e.ok){if(403===e.status)throw Error("ログイン・エラー");throw Error(`${e.status} ${e.statusText}`)}let s=await e.json();x(s),void 0!==t&&localStorage.setItem(t,n)}catch(e){u(e.message),x(null),void 0!==t&&localStorage.removeItem(t)}};return(0,o.useEffect)(()=>{if(void 0!==e.username&&void 0!==e.password)i.current.value=e.password,h();else if(void 0!==t){let e=localStorage.getItem(t);null!==e&&(i.current.value=e,a(e))}},[]),d?(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"authenticate-logout",children:[(0,r.jsxs)("span",{children:["User: ",d?d.username:""]}),void 0!==e.username&&void 0!==e.password?null:(0,r.jsx)("button",{type:"button",onClick:()=>{x(null),void 0!==t&&localStorage.removeItem(t)},children:"ログアウト"})]}),(0,r.jsx)(l.Provider,{value:d,children:e.children})]}):(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"authenticate-login",children:[(0,r.jsxs)("label",{children:[(0,r.jsx)("span",{children:"ユーザ名:"}),(0,r.jsx)("span",{children:(0,r.jsx)("input",{type:"text",placeholder:"ユーザ名",onChange:e=>a(e.target.value),value:n})})]}),(0,r.jsxs)("label",{children:[(0,r.jsx)("span",{children:"パスワード:"}),(0,r.jsx)("span",{children:(0,r.jsx)("input",{type:"password",ref:i,placeholder:"パスワード",defaultValue:""})})]}),(0,r.jsx)("button",{type:"button",onClick:h,children:"ログイン"})]}),(0,r.jsx)("div",{children:""===c?null:(0,r.jsx)("div",{className:"error-message",onClick:()=>u(""),children:c})})]})}}),o("6Jdkr",function(t,s){e(t.exports,"TextChat",()=>i);var r=n("c54Ow"),o=n("lbJE2"),l=n("brsYM"),a=n("lHCVX");let i=()=>{let e=(0,o.useContext)(l.LoginContext),t=e?e.username:"",s=(0,o.useContext)(a.SocketContext),n=s?s.current:null,[i,c]=(0,o.useState)(""),[u,d]=(0,o.useState)([]);(0,o.useEffect)(()=>{x.current.scrollIntoView({block:"nearest"})},[u]);let x=(0,o.useRef)(null),[h,m]=(0,o.useState)("*"),[v,f]=(0,o.useState)([]),p=e=>{d(t=>[...t,e])};(0,o.useEffect)(()=>{if(n)return console.log("[TextChat] adding listeners"),n.on("text",p),n.on("user-list",j),n.emit("user-list",{from:t}),()=>{console.log("[TextChat] removing listeners"),n.off("text",p),n.off("user-list",handleUserlist)}},[]),(0,o.useEffect)(()=>{x.current.scrollIntoView({block:"nearest"})},[u]);let j=e=>{f(e),0>e.indexOf(h)&&m("*")},g=()=>{n&&(n.emit("text",{from:t,to:h,text:i}),c(""))};return(0,r.jsxs)("div",{className:"text-chat",children:[(0,r.jsx)("div",{className:"text-chat-message-list-container",children:(0,r.jsxs)("div",{className:"text-chat-message-list",children:[u.map(e=>(0,r.jsx)("div",{className:e.from===t?"text-chat-from-me":"text-chat-from-them",children:e.from===t?(0,r.jsx)("div",{children:e.text}):(0,r.jsxs)("div",{children:[e.from," > ",e.text]})},e.from+e.time)),(0,r.jsx)("div",{ref:x})," "]})})," ",(0,r.jsxs)("div",{className:"text-chat-input",children:[(0,r.jsxs)("select",{onChange:e=>{m(e.target.value)},value:h,children:[" ",(0,r.jsx)("option",{value:"*",children:"*"})," ",v.map(e=>(0,r.jsx)("option",{value:e,children:e},e))]})," ",(0,r.jsx)("input",{type:"text",onChange:e=>{c(e.target.value)},value:i,onKeyUp:e=>{"Enter"===e.key&&i.length>0&&g()}}),(0,r.jsx)("button",{type:"button",onClick:g,disabled:null===n||""===i,children:"送信"})," "]})]})}});var l=n("c54Ow"),a=n("dFw4U"),i=n("aFIWk"),c=n("brsYM"),u=n("lHCVX"),d=n("6Jdkr"),l=n("c54Ow"),x=n("lbJE2"),c=n("brsYM"),u=n("lHCVX");const h=()=>{let e=(0,x.useContext)(c.LoginContext),t=e?e.username:"",s=(0,x.useContext)(u.SocketContext),r=s?s.current:null,[n,o]=(0,x.useState)(""),a=e=>{if(e.to===t&&e.text){let s=`[${e.from}] ${e.text}`;r.emit("text",{from:t,to:e.from,text:s}),o(`reply: ${s}`)}};return(0,x.useEffect)(()=>{if(r)return console.log(`[EchoBot (${t})] adding listeners`),r.on("text",a),()=>{console.log(`[EchoBot (${t})] removing listeners`),r.off("text",a)}},[]),(0,l.jsx)("div",{children:n})};(0,a.createRoot)(document.getElementById("root")).render((0,l.jsxs)(i.ErrorBoundary,{children:[(0,l.jsx)(c.Authenticate,{children:(0,l.jsx)(u.WithSocket,{nsp:"/chat",children:(0,l.jsx)(d.TextChat,{})})}),(0,l.jsx)("hr",{}),(0,l.jsx)(e=>(0,l.jsx)("div",{className:"echo-bot",children:(0,l.jsx)(c.Authenticate,{username:e.botname,password:e.password,children:(0,l.jsx)(u.WithSocket,{nsp:e.nsp,children:(0,l.jsx)(h,{})})})}),{botname:"EchoBot",password:"EchoBot",nsp:"/chat"})]}));
//# sourceMappingURL=report02.cf088188.js.map
